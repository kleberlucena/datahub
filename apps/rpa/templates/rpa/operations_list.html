{% extends "base/base.html" %}
{% load static %}
{% load custom_tags %}

<!-- styles -->
{% block style_sheet %}
  <link rel="stylesheet" href="{% static 'adminlte-3.1.0/plugins/datatables-bs4/css/dataTables.bootstrap4.min.css' %}">
  <link rel="stylesheet" href="{% static 'adminlte-3.1.0/plugins/datatables-responsive/css/responsive.bootstrap4.min.css' %}">
  <link rel="stylesheet" href="{% static 'adminlte-3.1.0/plugins/datatables-buttons/css/buttons.bootstrap4.min.css' %}">
  <style>
    @media (max-width: 768px) {
      .dtr-control::before {
        content: "\f107" !important; 
        font-family: "Font Awesome 5 Free" !important; 
        font-weight: 700 !important;
      }

      .border-for-in-course{
        border-left: 5px solid #FFC107 !important;
      }

      .border-for-done {
        border-left: 5px solid lightblue !important;
      }

      #new_operation_btn {
        margin-left: 0px !important;
      }
    }
  </style>
{% endblock style_sheet %}

  <!-- browser title -->
{% block title %} Operações {% endblock %}

  <!-- context title -->
{% block title-header %} Operações aéreas {% endblock %}

  <!-- breadcrumb -->
{% block breadcrumb %}
  <li class="breadcrumb-item"><a href="{% url 'rpa:painel' %}">Painel</a></li>
  <li class="breadcrumb-item active">Operações</li>
{% endblock %}

<!-- main container -->
{% block content %}
  <div class="card card-primary card-outline">
    <div class="card-header">
      <h3 class="card-title">Operações</h3>
    </div>

    <div class="card-body">
      <div id="objects_list_wrapper" class="dataTables_wrapper dt-bootstrap4">
        <table id="objects_list" class="table table-bordered table-striped dataTable dtr-inline" role="grid"
          aria-describedby="objects_list_info" width="100%">
          <thead>
            <tr>
              <th scope="col">ID</th>
              <th scope="col">Operação</th>
              <th scope="col">Operador</th>
              <th scope="col">Data</th>
              <th scope="col">Aeronave</th>
              <th scope="col">Status</th>
              <th class="removerDoPdf" scope="col">Ações</th>
            </tr>
          </thead>          
        </table>
      </div>    
    </div>
    <div class="card-footer">
        {% if request.user|has_group:'profile:rpa_basic' or request.user|has_group:'profile:rpa_advanced' %}
        <div class="row">
            <a href="{% url 'rpa:criar_nova_missao' %}" style="margin-right: 10px;">
              <button type="button" id="new_operation_btn" style="display: inline; width: 160px; height: 38px; margin-left: 10px" class="btn btn-block btn-primary mt-3"><i class="fa fa-plus"></i> Nova operação </button>
            </a>
            <a href="{% url 'rpa:points_of_interest' %}">
              <button type="button" style="display: inline" class="btn btn-outline-info mt-3"><i class="fa fa-cog nav-icon" aria-hidden="true"></i>
                Gerenciar Pontos </button>
            </a>
        {% endif %}
    </div>
  </div>
{% endblock content %}

  <!-- javascripts -->
{% block js %}
  <script src="{% static 'adminlte-3.1.0/plugins/datatables/jquery.dataTables.min.js' %}"></script>
  <script src="{% static 'adminlte-3.1.0/plugins/datatables-bs4/js/dataTables.bootstrap4.min.js' %}"></script>
  <script src="{% static 'adminlte-3.1.0/plugins/datatables-responsive/js/dataTables.responsive.min.js' %}"></script>
  <script src="{% static 'adminlte-3.1.0/plugins/datatables-responsive/js/responsive.bootstrap4.min.js' %}"></script>
  <script src="{% static 'adminlte-3.1.0/plugins/datatables-buttons/js/dataTables.buttons.min.js' %}"></script>
  <script src="{% static 'adminlte-3.1.0/plugins/datatables-buttons/js/buttons.bootstrap4.min.js' %}"></script>
  <script src="{% static 'adminlte-3.1.0/plugins/jszip/jszip.min.js' %}"></script>
  <script src="{% static 'adminlte-3.1.0/plugins/pdfmake/pdfmake.min.js' %}"></script>
  <script src="{% static 'adminlte-3.1.0/plugins/pdfmake/vfs_fonts.js' %}"></script>
  <script src="{% static 'adminlte-3.1.0/plugins/datatables-buttons/js/buttons.html5.min.js' %}"></script>
  <script src="{% static 'adminlte-3.1.0/plugins/datatables-buttons/js/buttons.print.min.js' %}"></script>
  <script src="{% static 'adminlte-3.1.0/plugins/datatables-buttons/js/buttons.colVis.min.js' %}"></script>  
  <script>
    $(function () {
      var dt_table = $('#objects_list').dataTable({
        buttons: ["pageLength", "pdf", "print", "excel", "colvis"],
        dom: "<'row'<'col-sm-12 col-md-6'B><'col-sm-12 col-md-6'f>>" + "<'row'<'col-sm-12'tr>>" + "<'row'<'col-sm-12 col-md-5'i><'col-sm-12 col-md-7'p>>",
        language: {"url": "//cdn.datatables.net/plug-ins/1.11.1/i18n/pt_br.json"},
        responsive: true,
        searching: true,
        processing: true,
        serverSide: true,
        stateSave: true,
        ajax: '{% url "rpa:operations_list_json" %}',
        order: [[ 0, "desc" ]],
        columnDefs: [
            {
              targets: [5],
                render: function(data, type, row) {
                    if (type === 'display') {
                        return data == "Ativo" ? '<span class="badge badge-success">Ativo</span>' : '<span class="badge badge-danger">Desativado</span>';
                    }
                    return data;  // retornar data para outros tipos (por exemplo, ordenação) sem formatação HTML
                }
            },
            {
              "render":
                function (data, type, row) {
                  var urlDetail = '{% url "rpa:ver_missao" "1" %}';
                  var id = data[0];
                  urlDetail = urlDetail.replace('1', id);
                  buttons = '<a  class="btn btn-outline-info btn-sm" href="'+ urlDetail +'">Visualizar</a>';
                  return buttons;
                },
              "data": null,
              "searchable": false,
              "width": "75px",
              "targets": [-1]
            },
            {'searchable': false, 'targets': [0, 3, 4, 5]},
            {'orderable': false, 'targets': []},
          ],

      });
    });
  </script>

{% endblock %}