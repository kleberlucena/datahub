{% extends "base/base.html" %}
{% load static %}

<!-- styles -->
{% block style_sheet %}
{% comment %} bacinf style_sheet {% endcomment %}
  <link rel="stylesheet" href="{% static 'adminlte-3.1.0/plugins/datatables-bs4/css/dataTables.bootstrap4.min.css' %}">
  <link rel="stylesheet" href="{% static 'adminlte-3.1.0/plugins/datatables-responsive/css/responsive.bootstrap4.min.css' %}">
  <link rel="stylesheet" href="{% static 'adminlte-3.1.0/plugins/datatables-buttons/css/buttons.bootstrap4.min.css' %}">
  <style>
    .detail_risk {
      display: flex;
      gap: 10px;
    }
    .report_details_card {
      width: 400px;
    }
    .detail_risk_img {
      height: 800px;
      margin: 0 auto;
    }
    .responsible_sign {
      width: 300px;
    }
    @media (max-width: 768px) {
      .detail_risk {
        display: flex;
        flex-direction: column;
        justify-content: start;
        width: 100%;
      }
      .dtr-control::before {
        content: "\f107" !important; 
        font-family: "Font Awesome 5 Free" !important; 
        font-weight: 700 !important;
      }

    }
  </style>

{% endblock style_sheet %}

<!-- browser title -->
{% block title %} Operações aéreas {% endblock %}

<!-- context title -->
{% block title-header %} Operações aéreas {% endblock %}

<!-- breadcrumb -->
{% block breadcrumb %}
{% comment %} <li class="breadcrumb-item active">Início</li> {% endcomment %}
{% endblock %}

<!-- main container -->
{% block content %}
<div class="card card-primary card-outline">
  <div class="card-header">
    <h3 class="card-title">Dados avaliação de risco operacional</h3>
  </div> 

  <div class="detail_risk">
    <div class="card card-primary col-md-4 mt-3">
      <div class="card-body">
        <strong>Responsável pelas informações: </strong> {{ risk_assessment.info_responsible }} 
        <hr>
        <strong>Cenário operacional: </strong> {{ risk_assessment.operational_scenario }} 
        <hr>
        <strong>Operador: </strong> {{ risk_assessment.operator }} 
        <hr>
        <strong>Data realizada: </strong> {{ risk_assessment.date|date:"d/m/Y" }} 
        <hr>
        <strong>Data de expiração: </strong> {{ risk_assessment.expiration_date|date:"d/m/Y" }} 
        <hr>
        <strong>CNPJ: </strong> {{ risk_assessment.cnpj }}
        <hr>
        <strong>Aeronaves: </strong> {{ risk_assessment.aircrafts.all|join:", " }}
        <hr>
        <strong>Legislação aplicável: </strong> <br> {{ risk_assessment.apllied_legislation }}
        <hr>
        <strong>Manter distância de terceiros </strong> 
        
        {% if risk_assessment.keep_distance_from_3rd == True %}
          Sim
        {% else %}
          Não  
        {% endif %}
          
        <hr>
        <strong>Piloto remoto ou Piloto observador precisa de curso </strong>
        
        {% if risk_assessment.pilots_capabilities == True %}
          Sim - Curso de Operador de RPAs – CORPA
        {% else %}
          Não
        {% endif %}
          
        <hr>
        <strong>Procedimento em caso de acidente </strong> <br> <p style="text-align: justify;">{{ risk_assessment.accident_procedure }}</p>
        <hr>
        <strong>Assinatura do responsável pelas informações </strong> <br>
        {% if risk_assessment.responsible_sign %}
          <img src="{{ risk_assessment.responsible_sign.url }}" alt="assinatura" class="responsible_sign">
        {% endif %}
          
        <hr>
      </div>
    </div>
    
    <div class="col-md-8 mt-3">
      <div class="card card-primary card-outline">
        <div class="card-header">
          <h3 class="card-title">Análises de risco</h3>
        </div>
        <div class="card-body">
          <div id="objects_list_wrapper" class="dataTables_wrapper dt-bootstrap4">
            <table id="objects_list" class="table table-bordered table-striped dataTable dtr-inline" role="grid"
              aria-describedby="objects_list_info" width="100%">
              <thead class="tabela_cabecalho">
                <tr>
                  <th scope="col">Situação</th>
                  <th scope="col">Probabilidade de ocorrência</th>
                  <th scope="col">Severidade da ocorrência</th>
                  <th scope="col">Risco</th>
                  <th scope="col">Tolerabilidade</th>
                  <th scope="col">Mitigação de riscos</th>
                  <th scope="col">Nível hierárquico</th>
                  <th class="removerDoPdf" scope="col">Ações</th>
                </tr>
              </thead>
              <tbody>
                {% for assessment in risk_assessment.assessment_set.all %}
                <tr>
                  <td>{{ assessment.situation }}</td>
                  <td>{{ assessment.probability_of_occurrence }}</td>
                  <td>{{ assessment.severity_of_occurrence }}</td>
                  <td>{{ assessment.risk }}</td>
                  <td>{{ assessment.tolerability }}</td>
                  <td>{{ assessment.mitigation_measures_risk }}</td>
                  <td>{{ assessment.hierarchy_authorization }}</td>
                  <td>
                    <div class="btn-group" style="display: flex; align-items: center; align-content: center;">
                      <button type="button" class="btn btn-outline-info dropdown-toggle dropdown-icon" data-toggle="dropdown"
                        aria-expanded="false">
                        <span class="sr-only">Toggle Dropdown</span>
                        Filtros
                      </button>
                      <div class="dropdown-menu" role="menu" style="">
                        <a class="dropdown-item" href="{% url 'rpa_manager:update_assessment' assessment.id %}">Editar análise</a>
                        {% if request.user.is_superuser %}
                          <a class="dropdown-item" href="{% url 'rpa_manager:delete_assessment' assessment.id %}">Excluir análise</a>
                        {% endif %}
                      </div>
                    </div>
                  </td> 
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

{% endblock content %}

<!-- javascripts -->
{% block js %}
  <!-- DataTables  & Plugins -->
  <script src="{% static 'adminlte-3.1.0/plugins/datatables/jquery.dataTables.min.js' %}"></script>
  <script src="{% static 'adminlte-3.1.0/plugins/datatables-bs4/js/dataTables.bootstrap4.min.js' %}"></script>
  <script src="{% static 'adminlte-3.1.0/plugins/datatables-responsive/js/dataTables.responsive.min.js' %}"></script>
  <script src="{% static 'adminlte-3.1.0/plugins/datatables-responsive/js/responsive.bootstrap4.min.js' %}"></script>
  <script src="{% static 'adminlte-3.1.0/plugins/datatables-buttons/js/dataTables.buttons.min.js' %}"></script>
  <script src="{% static 'adminlte-3.1.0/plugins/datatables-buttons/js/buttons.bootstrap4.min.js' %}"></script>
  <script src="{% static 'adminlte-3.1.0/plugins/jszip/jszip.min.js' %}"></script>
  <script src="{% static 'adminlte-3.1.0/plugins/pdfmake/pdfmake.min.js' %}"></script>
  <script src="{% static 'adminlte-3.1.0/plugins/pdfmake/vfs_fonts.js' %}"></script>
  <script src="{% static 'adminlte-3.1.0/plugins/datatables-buttons/js/buttons.html5.min.js' %}"></script>
  <script src="{% static 'adminlte-3.1.0/plugins/datatables-buttons/js/buttons.print.min.js' %}"></script>
  <script src="{% static 'adminlte-3.1.0/plugins/datatables-buttons/js/buttons.colVis.min.js' %}"></script>
  <script>
    var table = $('#objects_list').DataTable( {
        lengthChange: false,
        buttons: [ 'pageLength',
        {
          extend: 'excel',
          text: 'Excel',
          exportOptions: {
            columns: ':not(.removerDoPdf)'
          }
        },
        {
          extend: 'print',
          text: 'Imprimir',
          exportOptions: {
            columns: ':not(.removerDoPdf)'
          }
        },
        'colvis'
      ],
        dom: "<'row'<'col-sm-12 col-md-6'B><'col-sm-12 col-md-6'f>>" + "<'row'<'col-sm-12'tr>>" + "<'row'<'col-sm-12 col-md-5'i><'col-sm-12 col-md-7'p>>",
        language: { "url": "//cdn.datatables.net/plug-ins/1.11.1/i18n/pt_br.json" },
        responsive: true,
        searching: true,
        processing: true,
        columnDefs: [{ "width": "100px", targets: [-1]}]
    } );
  </script>
{% endblock %}



<!-- 
pip install weasyprint
Jhonata Dias16:32
class ReportDetailView(DetailView):
    model = Report
    template_name = 'idoc/report_detail.html'

    def render_to_response(self, context, **response_kwargs):
        html = render_to_string(self.template_name, context)

        # Configuração do tamanho de papel para A4 e quebra de palavras
        css = '''
        @page { size: A4; margin: 2cm; }
        body { word-wrap: break-word; }
        '''

        # Caminho para o diretório que contém a imagem e que será usado como URI base
-->