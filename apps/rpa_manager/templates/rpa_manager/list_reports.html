{% extends "base/base.html" %}
{% load static %}
{% load custom_tags %}

<!-- styles -->
{% block style_sheet %}
{% comment %} bacinf style_sheet {% endcomment %}
  <link rel="stylesheet" href="{% static 'adminlte-3.1.0/plugins/datatables-bs4/css/dataTables.bootstrap4.min.css' %}">
  <link rel="stylesheet" href="{% static 'adminlte-3.1.0/plugins/datatables-responsive/css/responsive.bootstrap4.min.css' %}">
  <link rel="stylesheet" href="{% static 'adminlte-3.1.0/plugins/datatables-buttons/css/buttons.bootstrap4.min.css' %}">
  <style>
    @media (max-width: 768px) {
      .dtr-control::before {
        content: "\f107" !important; 
        font-family: "Font Awesome 5 Free" !important; 
        font-weight: 700 !important;
      }
    }
  </style>
{% endblock style_sheet %}

<!-- browser title -->
{% block title %} Cadernetas {% endblock %}

<!-- context title -->
{% block title-header %} Operações aéreas {% endblock %}

<!-- breadcrumb -->
{% block breadcrumb %}
  <li class="breadcrumb-item"><a href="{% url 'rpa_manager:painel' %}">Painel</a></li>
  <li class="breadcrumb-item active">Cadernetas</li>
{% endblock %}

<!-- main container -->
{% block content %}
  <div class="card card-primary card-outline">
    <div class="card-header">
      <h3 class="card-title">Cadernetas</h3>
    </div>
    <div class="card-body">
      <div id="objects_list_wrapper" class="dataTables_wrapper dt-bootstrap4">
        <table id="objects_list" class="table table-bordered table-striped dataTable dtr-inline" role="grid"
          aria-describedby="objects_list_info" width="100%">
          <thead>
            <tr>
              <th scope="col">Título</th>
              <th scope="col">Operador</th>
              <th scope="col">Data</th>
              <th scope="col">Horário</th>
              <th scope="col">Local</th>
              <th scope="col">Aeronave</th>
              <th scope="col">Entidade Apoiada</th>
              <th class="removerDoPdf" scope="col">Ações</th>
            </tr>
          </thead>

          <tbody>
            {% for relatorio in relatorios %}
            <tr>
              <td>{{ relatorio.title }}</td>
              <td>{{ relatorio.remote_pilot.military }}</td>
              <td data-sort='YYYYMMDD'>{{ relatorio.date|date:"d/m/Y" }}</td>
              <td>{{ relatorio.initial_time }}</td>
              <td>{{ relatorio.location }}</td>
              <td>{{ relatorio.aircraft }}</td>
              <td>{{ relatorio.entity_support }}</td>

              {% if request.user|has_group:'profile:rpa_view' or request.user|has_group:'profile:rpa_basic' %}
                <td>
                  <a href="{% url 'rpa_manager:ver_relatorio' relatorio.id %}">
                    <button type="button" class="btn btn-outline-info btn-block">Ver dados</button>
                  </a>
                </td>
              {% else %}
                <td>
                  <div class="btn-group" style="display: flex; align-items: center; align-content: center;">
                    <button type="button" class="btn btn-outline-info dropdown-toggle dropdown-icon" data-toggle="dropdown" aria-expanded="false">
                    <span class="sr-only">Toggle Dropdown</span>
                    Filtros
                    </button>
                    <div class="dropdown-menu" role="menu" style="">
                        <a class="dropdown-item" href="{% url 'rpa_manager:ver_relatorio' relatorio.id %}">Ver Caderneta</a>
                        <a class="dropdown-item" href="{% url 'rpa_manager:editar_relatorio' relatorio.id %}">Editar Caderneta</a>
                        {% if request.user.is_superuser %}
                          <a class="dropdown-item" href="{% url 'rpa_manager:deletar_relatorio' relatorio.id %}">Excluir Caderneta</a>
                        {% endif %}  
                    </div>
                  </div>
                </td>
              {% endif %}
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
{% endblock content %}

<!-- javascripts -->
{% block js %}
<!-- DataTables  & Plugins -->
<script src="{% static 'adminlte-3.1.0/plugins/datatables/jquery.dataTables.min.js' %}"></script>
<script src="{% static 'adminlte-3.1.0/plugins/datatables-bs4/js/dataTables.bootstrap4.min.js' %}"></script>
<script src="{% static 'adminlte-3.1.0/plugins/datatables-responsive/js/dataTables.responsive.min.js' %}"></script>
<script src="{% static 'adminlte-3.1.0/plugins/datatables-responsive/js/responsive.bootstrap4.min.js' %}"></script>
<script src="{% static 'adminlte-3.1.0/plugins/datatables-buttons/js/dataTables.buttons.min.js' %}"></script>
<script src="{% static 'adminlte-3.1.0/plugins/datatables-buttons/js/buttons.bootstrap4.min.js' %}"></script>
<script src="{% static 'adminlte-3.1.0/plugins/jszip/jszip.min.js' %}"></script>
<script src="{% static 'adminlte-3.1.0/plugins/pdfmake/pdfmake.min.js' %}"></script>
<script src="{% static 'adminlte-3.1.0/plugins/pdfmake/vfs_fonts.js' %}"></script>
<script src="{% static 'adminlte-3.1.0/plugins/datatables-buttons/js/buttons.html5.min.js' %}"></script>
<script src="{% static 'adminlte-3.1.0/plugins/datatables-buttons/js/buttons.print.min.js' %}"></script>
<script src="{% static 'adminlte-3.1.0/plugins/datatables-buttons/js/buttons.colVis.min.js' %}"></script>
<script>
  var table = $('#objects_list').DataTable({
    lengthChange: false,
    buttons: [ 'pageLength',
        {
          extend: 'excel',
          text: 'Excel',
          exportOptions: {
            columns: ':not(.removerDoPdf)'
          }
        },
        {
          extend: 'pdf',
          text: 'PDF',
          exportOptions: {
            columns: ':not(.removerDoPdf)'
          }
        },
        {
          extend: 'print',
          text: 'Imprimir',
          exportOptions: {
            columns: ':not(.removerDoPdf)'
          }
        },
        'colvis'
      ],
    dom: "<'row'<'col-sm-12 col-md-6'B><'col-sm-12 col-md-6'f>>" + "<'row'<'col-sm-12'tr>>" + "<'row'<'col-sm-12 col-md-5'i><'col-sm-12 col-md-7'p>>",
    language: { "url": "//cdn.datatables.net/plug-ins/1.11.1/i18n/pt_br.json" },
    responsive: true,
    searching: true,
    processing: true,
    columnDefs: [{ "width": "200px", targets: [-1] }],
    order: [
      [2, 'desc'],
    ]
  });
</script>
{% endblock %}