{% extends "base/base.html" %}
{% load static %}

<!-- styles -->
{% block style_sheet %}
	{% comment %} bacinf style_sheet {% endcomment %}
	<link rel="stylesheet" href="{% static 'adminlte-3.1.0/plugins/datatables-bs4/css/dataTables.bootstrap4.min.css' %}">
	<link rel="stylesheet" href="{% static 'adminlte-3.1.0/plugins/datatables-responsive/css/responsive.bootstrap4.min.css' %}">
	<link rel="stylesheet" href="{% static 'adminlte-3.1.0/plugins/datatables-buttons/css/buttons.bootstrap4.min.css' %}">
	<link rel="stylesheet" href="{% static 'leaflet/leaflet.css' %}">
  <style>
    .select_date_form {
      display: flex;
      flex-direction: row;
      align-items: center;
      gap: 10px; 
      margin-bottom: 10px;
    }
    .select_date_btn {
      height: 40px;
      width: 120px;
      margin-top: 32px;
    }
    
  </style>
{% endblock style_sheet %}

<!-- browser title -->
{% block title %} RPA MANAGER | Painel {% endblock %}

<!-- context title -->
{% block title-header %} Operações aéreas {% endblock %}

<!-- breadcrumb -->
{% block breadcrumb %}
<li class="breadcrumb-item active">Painel</li>
{% endblock %}

<!-- main container -->
{% block content %}
	
	<div class="grid-container">
		<div class="row">
			<div class="col-lg-3 col-6">
				<div class="small-box bg-info">
					<div class="inner">
						<h3>150</h3>
						<p>New Orders</p>
					</div>
					<div class="icon">
						<i class="ion ion-bag"></i>
					</div>
					<a href="#" class="small-box-footer">More info <i class="fas fa-arrow-circle-right"></i></a>
				</div>
			</div>

			<div class="col-lg-3 col-6">

				<div class="small-box bg-success">
					<div class="inner">
						<h3>53<sup style="font-size: 20px">%</sup></h3>
						<p>Bounce Rate</p>
					</div>
					<div class="icon">
						<i class="ion ion-stats-bars"></i>
					</div>
					<a href="#" class="small-box-footer">More info <i class="fas fa-arrow-circle-right"></i></a>
				</div>
			</div>

			<div class="col-lg-3 col-6">

				<div class="small-box bg-warning">
					<div class="inner">
						<h3>44</h3>
						<p>User Registrations</p>
					</div>
					<div class="icon">
						<i class="ion ion-person-add"></i>
					</div>
					<a href="#" class="small-box-footer">More info <i class="fas fa-arrow-circle-right"></i></a>
				</div>
			</div>

			<div class="col-lg-3 col-6">

				<div class="small-box bg-danger">
					<div class="inner">
						<h3>65</h3>
						<p>Unique Visitors</p>
					</div>
					<div class="icon">
						<i class="ion ion-pie-graph"></i>
					</div>
					<a href="#" class="small-box-footer">More info <i class="fas fa-arrow-circle-right"></i></a>
				</div>
			</div>

		</div>


		<div class="callout callout-info">
			<h5>I am an info callout!</h5>
			<p>Follow the steps to continue to payment.</p>
		</div> 
</div>

<div class="card card-primary card-outline">
  <div class="card-header">
    <h3 class="card-title">Voos realizados</h3>
  </div> 
      <div class="card-body">
        <form id="coordinatesForm" method='GET'>
          {% csrf_token %}
          <div class="select_date_form">
            <div class="select_month">
              <label for="month">Mês:</label>
              <select id="month" class="form-control row-md-4" name="month">
                <option value="1">Janeiro</option>
                <option value="2">Fevereiro</option>
                <option value="3">Março</option>
                <option value="4">Abril</option>
                <option value="5">Maio</option>
                <option value="6">Junho</option>
                <option value="7">Julho</option>
                <option value="8">Agosto</option>
                <option value="9">Setembro</option>
                <option value="10">Outubro</option>
                <option value="11">Novembro</option>
                <option value="12">Dezemrbo</option>
              </select>
            </div>
          
            <div class="select_year">
              <label for="year">Ano:</label>
              <select id="year" class="form-control row-md-3" name="year">
              <option value="2023">2023</option>
              <option value="2022">2022</option>
              <option value="2021">2021</option>
              </select>
            </div>
              <button type="submit" class="btn btn-outline-primary ml-3 select_date_btn">Filtrar</button>
          </div>

        </form>
        <div id="map" style="height: 500px;"></div>
      </div>

</div>

{% endblock content %}

<!-- javascripts -->
{% block js %}
	<!-- DataTables  & Plugins -->
	<script src="{% static 'adminlte-3.1.0/plugins/datatables/jquery.dataTables.min.js' %}"></script>
	<script src="{% static 'adminlte-3.1.0/plugins/datatables-bs4/js/dataTables.bootstrap4.min.js' %}"></script>
	<script src="{% static 'adminlte-3.1.0/plugins/datatables-responsive/js/dataTables.responsive.min.js' %}"></script>
	<script src="{% static 'adminlte-3.1.0/plugins/datatables-responsive/js/responsive.bootstrap4.min.js' %}"></script>
	<script src="{% static 'adminlte-3.1.0/plugins/datatables-buttons/js/dataTables.buttons.min.js' %}"></script>
	<script src="{% static 'adminlte-3.1.0/plugins/datatables-buttons/js/buttons.bootstrap4.min.js' %}"></script>
	<script src="{% static 'adminlte-3.1.0/plugins/jszip/jszip.min.js' %}"></script>
	<script src="{% static 'adminlte-3.1.0/plugins/pdfmake/pdfmake.min.js' %}"></script>
	<script src="{% static 'adminlte-3.1.0/plugins/pdfmake/vfs_fonts.js' %}"></script>
	<script src="{% static 'adminlte-3.1.0/plugins/datatables-buttons/js/buttons.html5.min.js' %}"></script>
	<script src="{% static 'adminlte-3.1.0/plugins/datatables-buttons/js/buttons.print.min.js' %}"></script>
	<script src="{% static 'adminlte-3.1.0/plugins/datatables-buttons/js/buttons.colVis.min.js' %}"></script>
	<script src="{% static 'adminlte-3.1.0/plugins/select2/js/select2.min.js' %}"></script>
	<script src="{% static 'leaflet/leaflet.js' %}"></script>
	<script type="text/javascript">
		// Função que será executada quando o documento estiver pronto
		document.addEventListener('DOMContentLoaded', function () {
				coordinatesJson = {{ coordinates_json | safe }}
        coordinatesByDate = {{ coordinates_by_date_json | safe }}
        let centerCoordinates = [coordinatesJson.latitude, coordinatesJson.longitude];
        let zoomLevel = 8;

				let map = L.map('map').setView(centerCoordinates, zoomLevel);
        let marker = new L.marker(centerCoordinates)
        .addTo(map)
        .bindPopup(coordinatesJson.titulo + '<br>' +  coordinatesJson.latitude + ',' + coordinatesJson.longitude).openPopup();

				
        for (let i = 0; i < coordinatesByDate.length; i++) {
          titulo = coordinatesByDate[i].titulo
          latitude = coordinatesByDate[i].latitude !== null ? coordinatesByDate[i].latitude : 0.0
          longitude = coordinatesByDate[i].longitude !== null ? coordinatesByDate[i].longitude : 0.0

          if(latitude !== 0.0 && longitude !== 0.0) {
            let marker = new L.marker([latitude, longitude])
            .addTo(map)
            .bindPopup(titulo + '<br>' +  latitude + ',' + longitude).openPopup();
          }
        } 
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

				let circle = L.circle(centerCoordinates, {
					color: 'red',
					fillColor: '#f03',
					fillOpacity: 0.1,
					radius: 500
			  }).addTo(map); 
		});
	</script>
{% endblock %}